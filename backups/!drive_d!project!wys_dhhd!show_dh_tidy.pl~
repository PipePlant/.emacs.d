use strict;
use warnings;
use Data::Dumper;
use JSON;
use feature qw(say);

$| = 1;
my $json = new JSON;
my $tidy_file = "./tmp_data/dh_tidy.txt";
my $show_file = "./tmp_data/dh_show.txt";

open my $TIDY ,"<", $tidy_file or die $!;
open my $SHOW ,">", $show_file or die $!;

while (<$TIDY>) {
    my $line = $_;
    my %item = %{$json->decode($line)};
    say $SHOW "=========";
    
    # ```word```
    say $SHOW $item{"word"};
    
    # ***layer 1***
    if (exists $item{"category"}) {
        foreach my $catg (@{$item{"category"}}) {
            # ***layer 2***
            foreach my $sub (@{${$catg}{"sublayer"}}) {
                say $SHOW "发音:  \t".${$sub}{"pron"} if exists ${$sub}{"pron"};
                say $SHOW "语法:  \t".${$sub}{"gram"} if exists ${$sub}{"gram"};
                say $SHOW "变种词:\t".${$sub}{"variant"} if exists ${$sub}{"variant"};
                say $SHOW "短语:  \t".${$sub}{"phrase"} if exists ${$sub}{"phrase"};
            }
            foreach my $sen (@{${$catg}{"sense"}}) {
                say $SHOW "\t语法:  \t".${$sen}{"gram"} if exists ${$sen}{"gram"};
                say $SHOW "\t风格:  \t".${$sen}{"style"} if exists ${$sen}{"style"};
                say $SHOW "\t地域:  \t".${$sen}{"region"} if exists ${$sen}{"region"};
                say $SHOW "\t变种词:\t".${$sen}{"variant"} if exists ${$sen}{"variant"};
                say $SHOW "\t释义:  \t".${$sen}{"def"} if exists ${$sen}{"def"};
                say $SHOW "\t例句:  \t".${$sen}{"example"} if exists ${$sen}{"example"};
                say $SHOW "\t短语:  \t".${$sen}{"phrase"} if exists ${$sen}{"phrase"};
                # ***layer 3***
                foreach my $idm (@{${$sen}{"idiom"}}) {
                    say $SHOW "\t\t用法:  \t".${$idm}{"title"} if exists ${$idm}{"title"};
                    say $SHOW "\t\t语法:  \t".${$idm}{"style"} if exists ${$idm}{"def"};
                    say $SHOW "\t\t短语:  \t".${$idm}{"phrase"} if exists ${$idm}{"phrase"};
                    say $SHOW "\t\t解释:  \t".${$idm}{"trans"} if exists ${$idm}{"trans"};
                }
            }
        }
    }
}
close $SHOW;
close $TIDY;
