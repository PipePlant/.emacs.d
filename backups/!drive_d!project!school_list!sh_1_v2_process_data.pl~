use warnings;
use strict;
use Data::Dumper;
use feature qw(say);
use JSON;
use Encode;

my $in = "./original_data/sh_shcool_16Sep_original_encode.txt";
my $out = "./sh/v2_sh_schools.txt";
my $area_out = "./sh/v2_areas.txt";

# ```~~~```
open my $IN ,"<", $in or die $!;
open my $OUT ,">", $out or die $!;
open my $AREA ,">", $area_out or die $!;

my $prevLine = "";
my $regionCode = "";
while (<$IN>) {

	my $line = $_;
	while ($line =~ /\('city_qu_(\d+)'\)">(.+?)</g) {
		
		say $AREA "$1\t$2";
	}
	if ($line =~ /<ul id="city_qu_(\d+)" style="display:none;">/) {

		my $area = $1;
        $regionCode = $area;
		$prevLine = $area;
	}
	if ($line =~ /\d">(.+?)<\/a><\/li>/) {

		my $school = $1;
		$school =~ s/^ +| +$//g;
		say $OUT $regionCode."\t".$school;
		$prevLine = $school;
	}
}	

close $IN;
close $OUT;
close $AREA;
